<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>CCM License Admin</title>
    <link rel="stylesheet" href="{{ request.url_for('static', path='admin.css') }}" />
  </head>
  <body>
    <div class="bg-shape bg-shape-a"></div>
    <div class="bg-shape bg-shape-b"></div>
    <main class="shell">
      <header class="hero">
        <h1>CCM License Admin</h1>
        <p>Token TTL: <strong>{{ token_ttl_seconds }}</strong> sec</p>
        <p class="mono">DB: {{ db_path }}</p>
      </header>

      {% if message %}
      <section class="notice notice-success">{{ message }}</section>
      {% endif %}
      {% if error %}
      <section class="notice notice-error">{{ error }}</section>
      {% endif %}

      <section class="panel panel-create">
        <h2>Create License</h2>
        <form method="post" action="{{ create_action }}" class="create-form">
          <label>
            Days
            <input type="number" name="days" min="1" required />
          </label>
          <label>
            License Key (optional)
            <input type="text" name="key" placeholder="ABCD-EFGH-JKLM" />
          </label>
          <label>
            Note (optional)
            <input type="text" name="note" placeholder="trial, customer name, etc." />
          </label>
          <button type="submit">Create</button>
        </form>
      </section>

      <section class="panel panel-list">
        <div class="panel-title">
          <h2>Licenses</h2>
          <span>{{ licenses|length }} total</span>
        </div>
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>License</th>
                <th>Status</th>
                <th>Issued</th>
                <th>Expires</th>
                <th>Days Left</th>
                <th>Note</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              {% if licenses %}
                {% for item in licenses %}
                <tr>
                  <td class="mono">{{ item.license_key }}</td>
                  <td>
                    <span class="badge badge-{{ item.status }}">
                      {{ item.status }}
                    </span>
                  </td>
                  <td class="mono">{{ item.issued_at }}</td>
                  <td class="mono">{{ item.license_expires_at }}</td>
                  <td>
                    {% if item.is_expired %}
                      <span class="expired">expired</span>
                    {% else %}
                      {{ item.days_left }}
                    {% endif %}
                  </td>
                  <td>{{ item.note or "-" }}</td>
                  <td>
                    {% if item.status == "active" %}
                    <form method="post" action="{{ item.disable_action }}">
                      <button type="submit" class="danger">Disable</button>
                    </form>
                    {% else %}
                    <span class="muted">Disabled</span>
                    {% endif %}
                  </td>
                </tr>
                {% endfor %}
              {% else %}
              <tr>
                <td colspan="7" class="empty">No licenses yet.</td>
              </tr>
              {% endif %}
            </tbody>
          </table>
        </div>
      </section>
    </main>
  </body>
</html>
